<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Base SEO Meta Tags (will be updated dynamically) -->
    <title>JW Creative - Article</title>
    <meta
      name="description"
      content="Read the latest articles and insights from Jordan Wheeler, Full Stack Developer specializing in web development, programming, and technology."
    />
    <meta
      name="keywords"
      content="web development, programming, technology, full stack developer, Jordan Wheeler"
    />
    <meta name="author" content="Jordan Wheeler" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph Meta Tags for Social Media -->
    <meta property="og:type" content="article" />
    <meta property="og:title" content="JW Creative - Article" />
    <meta
      property="og:description"
      content="Read the latest articles and insights from Jordan Wheeler, Full Stack Developer."
    />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="JW Creative" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="JW Creative - Article" />
    <meta
      name="twitter:description"
      content="Read the latest articles and insights from Jordan Wheeler, Full Stack Developer."
    />
    <meta name="twitter:creator" content="@yourtwitter" />

    <!-- Canonical URL (prevents duplicate content issues) -->
    <link rel="canonical" href="" />

    <!-- Schema.org Structured Data (will be populated dynamically) -->
    <script type="application/ld+json" id="article-schema">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "Loading...",
        "description": "Loading...",
        "author": {
          "@type": "Person",
          "name": "Jordan Wheeler",
          "url": "https://jwcreative.ca"
        },
        "publisher": {
          "@type": "Organization",
          "name": "JW Creative",
          "url": "https://jwcreative.ca"
        },
        "datePublished": "",
        "dateModified": "",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": ""
        }
      }
    </script>

    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap"
      rel="stylesheet"
    />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/article.css" />
    <link rel="stylesheet" href="css/all.min.css" />

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <style>
      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 3rem;
        color: #666;
      }

      .spinner {
        width: 32px;
        height: 32px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error-message {
        text-align: center;
        color: #e74c3c;
        padding: 2rem;
        background: #fdf2f2;
        border-radius: 8px;
        margin: 1rem 0;
      }

      .nav-post.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
      }

      .nav-post {
        transition: all 0.3s ease;
      }

      .nav-post:hover:not(.disabled) {
        transform: translateY(-2px);
      }

      .post-navigation {
        gap: 1rem;
      }

      .nav-placeholder {
        flex: 1;
        min-height: 80px;
      }

      /* Article content SEO optimizations */
      .post-content h1,
      .post-content h2,
      .post-content h3 {
        margin-top: 2rem;
        margin-bottom: 1rem;
      }

      .post-content img {
        max-width: 100%;
        height: auto;
      }

      /* Breadcrumbs for better navigation */
      .breadcrumbs {
        padding: 1rem 0;
        font-size: 0.9rem;
        color: #666;
      }

      .breadcrumbs a {
        color: #3498db;
        text-decoration: none;
      }

      .breadcrumbs a:hover {
        text-decoration: underline;
      }

      .breadcrumbs span {
        margin: 0 0.5rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="profile-section">
          <div class="profile-image">JW</div>
          <h2 class="profile-name">Jordan Wheeler</h2>
          <p class="profile-title">Full Stack Developer</p>
        </div>

        <nav>
          <ul class="nav-menu">
            <li class="nav-item">
              <a href="index.html" class="nav-link">Home</a>
            </li>
            <li class="nav-item">
              <a href="index.html#about" class="nav-link">About</a>
            </li>
            <li class="nav-item">
              <a href="index.html#projects" class="nav-link">Projects</a>
            </li>
            <li class="nav-item">
              <a href="blog.html" class="nav-link active">Blog</a>
            </li>
            <li class="nav-item">
              <a href="index.html#contact" class="nav-link">Contact</a>
            </li>
          </ul>
        </nav>

        <div class="contact-info">
          <div class="contact-item">
            <div class="contact-icon">
              <i class="fa-solid fa-envelope"></i>
            </div>
            <span>hello@jwcreative.ca</span>
          </div>
          <div class="contact-item">
            <div class="contact-icon">
              <i class="fas fa-map-marker-alt"></i>
            </div>
            <span>Newfoundland, Canada</span>
          </div>

          <div class="social-links">
            <a href="#" class="social-link" aria-label="Facebook">
              <i class="fa-brands fa-facebook-f"></i>
            </a>
            <a href="#" class="social-link" aria-label="Instagram">
              <i class="fa-brands fa-instagram"></i>
            </a>
            <a href="#" class="social-link" aria-label="Twitter">
              <i class="fa-brands fa-x"></i>
            </a>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <button
          class="menu-toggle"
          onclick="toggleSidebar()"
          aria-label="Toggle navigation menu"
        >
          ‚ò∞
        </button>

        <!-- Single Post Section -->
        <section class="post-section">
          <div class="post-container">
            <!-- Breadcrumbs -->
            <nav class="breadcrumbs" aria-label="Breadcrumb">
              <a href="index.html">Home</a>
              <span>‚Üí</span>
              <a href="blog.html">Blog</a>
              <span>‚Üí</span>
              <span id="breadcrumb-title">Article</span>
            </nav>

            <!-- Back Button -->
            <a href="blog.html" class="back-button">
              <span>‚Üê</span>
              <span>Back to Blog</span>
            </a>

            <!-- Loading State -->
            <div id="loading-state" class="loading-spinner">
              <div class="spinner"></div>
              <span>Loading article...</span>
            </div>

            <!-- Error State -->
            <div id="error-state" class="error-message" style="display: none">
              <h3>Error Loading Article</h3>
              <p id="error-message">
                Something went wrong while loading this article.
              </p>
              <a href="blog.html" style="color: #3498db; text-decoration: none"
                >‚Üê Return to Blog</a
              >
            </div>

            <!-- Article Content -->
            <article
              id="article-content"
              style="display: none"
              itemscope
              itemtype="https://schema.org/Article"
            >
              <!-- Post Header -->
              <header class="post-header">
                <span
                  class="post-category"
                  id="post-category"
                  itemprop="articleSection"
                  >Loading...</span
                >
                <h1 class="post-title" id="post-title" itemprop="headline">
                  Loading Article...
                </h1>
                <div class="post-meta">
                  <div class="meta-item">
                    <span>üìÖ</span>
                    <time id="post-date" itemprop="datePublished"
                      >Loading...</time
                    >
                  </div>
                  <div class="meta-item">
                    <span>‚è±Ô∏è</span>
                    <span id="post-read-time">Loading...</span>
                  </div>
                  <div class="meta-item">
                    <span>üëÄ</span>
                    <span id="post-views">Loading...</span>
                  </div>
                  <div class="meta-item">
                    <span>‚úçÔ∏è</span>
                    <span
                      id="post-author"
                      itemprop="author"
                      itemscope
                      itemtype="https://schema.org/Person"
                    >
                      <span itemprop="name">Loading...</span>
                    </span>
                  </div>
                </div>
                <p
                  class="post-description"
                  id="post-description"
                  itemprop="description"
                >
                  Loading description...
                </p>
              </header>

              <!-- Post Content -->
              <div class="post-content" itemprop="articleBody">
                <div id="post-body">Loading content...</div>

                <!-- Post Tags -->
                <div class="post-tags" id="post-tags" itemprop="keywords">
                  <!-- Tags will be populated here -->
                </div>
              </div>

              <!-- Post Navigation -->
              <nav
                class="post-navigation"
                id="post-navigation"
                aria-label="Article navigation"
              >
                <!-- Navigation will be populated here -->
              </nav>
            </article>
          </div>
        </section>
      </main>
    </div>

    <script>
      // Article management class with SEO enhancements
      class ArticleManager {
        constructor() {
          this.articleId = this.getArticleId();
          this.baseUrl =
            window.location.origin +
            window.location.pathname.replace("article.html", "");
          this.siteUrl = "https://jwcreative.ca"; // Update with your actual domain
          this.init();
        }

        getArticleId() {
          const params = new URLSearchParams(window.location.search);
          return params.get("id");
        }

        init() {
          if (!this.articleId) {
            this.showError("Article ID not provided.");
            return;
          }

          this.loadArticle();
        }

        async loadArticle() {
          try {
            const response = await fetch(
              `api/get-article.php?id=${this.articleId}`
            );

            if (!response.ok) {
              if (response.status === 404) {
                throw new Error("Article not found.");
              } else {
                throw new Error(
                  `Failed to load article. Status: ${response.status}`
                );
              }
            }

            const article = await response.json();

            if (article.error) {
              throw new Error(article.error);
            }

            this.renderArticle(article);
            this.updateSEOTags(article);
            this.hideLoading();
          } catch (error) {
            console.error("Error loading article:", error);
            this.showError(error.message);
          }
        }

        renderArticle(article) {
          // Update article content
          document.getElementById("post-category").textContent =
            article.category || "Uncategorized";
          document.getElementById("post-title").textContent = article.title;
          document.getElementById("post-author").textContent = article.author;
          document.getElementById("post-read-time").textContent =
            article.read_time;
          document.getElementById(
            "post-views"
          ).textContent = `${article.views} views`;
          document.getElementById("post-body").innerHTML = article.content;

          // Update breadcrumb
          document.getElementById("breadcrumb-title").textContent =
            this.truncateText(article.title, 50);

          // Format and display date
          const dateObj = new Date(article.date_posted.replace(" ", "T"));
          const formattedDate = dateObj.toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          });
          const postDateElement = document.getElementById("post-date");
          postDateElement.textContent = formattedDate;
          postDateElement.setAttribute("datetime", dateObj.toISOString());

          // Create description from content if not provided
          const description =
            article.excerpt || this.createExcerpt(article.content, 200);
          document.getElementById("post-description").textContent = description;

          // Render tags
          this.renderTags(article.tags);

          // Render navigation
          this.renderNavigation(article.navigation);

          // Add alt text to images that don't have it
          this.optimizeImages();
        }

        updateSEOTags(article) {
          const title = `${article.title} | JW Creative`;
          const description =
            article.excerpt || this.createExcerpt(article.content, 160);
          const keywords = article.tags
            ? article.tags
                .split(",")
                .map((tag) => tag.trim())
                .join(", ")
            : "";
          const articleUrl = `${this.siteUrl}article.html?id=${this.articleId}`;
          const dateObj = new Date(article.date_posted.replace(" ", "T"));

          // Update page title
          document.title = title;

          // Update meta tags
          this.updateMetaTag("name", "description", description);
          this.updateMetaTag("name", "keywords", keywords);
          this.updateMetaTag("name", "author", article.author);

          // Update Open Graph tags
          this.updateMetaTag("property", "og:title", title);
          this.updateMetaTag("property", "og:description", description);
          this.updateMetaTag("property", "og:url", articleUrl);
          this.updateMetaTag("property", "og:article:author", article.author);
          this.updateMetaTag(
            "property",
            "og:article:published_time",
            dateObj.toISOString()
          );
          this.updateMetaTag(
            "property",
            "og:article:section",
            article.category
          );

          // Update Twitter Card tags
          this.updateMetaTag("name", "twitter:title", title);
          this.updateMetaTag("name", "twitter:description", description);

          // Update canonical URL
          this.updateCanonicalUrl(articleUrl);

          // Update structured data
          this.updateStructuredData(article, articleUrl, dateObj);
        }

        updateMetaTag(attribute, name, content) {
          if (!content) return;

          let tag = document.querySelector(`meta[${attribute}="${name}"]`);
          if (!tag) {
            tag = document.createElement("meta");
            tag.setAttribute(attribute, name);
            document.head.appendChild(tag);
          }
          tag.setAttribute("content", content);
        }

        updateCanonicalUrl(url) {
          let canonical = document.querySelector('link[rel="canonical"]');
          if (!canonical) {
            canonical = document.createElement("link");
            canonical.setAttribute("rel", "canonical");
            document.head.appendChild(canonical);
          }
          canonical.setAttribute("href", url);
        }

        updateStructuredData(article, articleUrl, dateObj) {
          const schema = {
            "@context": "https://schema.org",
            "@type": "Article",
            headline: article.title,
            description:
              article.excerpt || this.createExcerpt(article.content, 200),
            author: {
              "@type": "Person",
              name: article.author,
              url: this.siteUrl,
            },
            publisher: {
              "@type": "Organization",
              name: "JW Creative",
              url: this.siteUrl,
            },
            datePublished: dateObj.toISOString(),
            dateModified: dateObj.toISOString(),
            mainEntityOfPage: {
              "@type": "WebPage",
              "@id": articleUrl,
            },
            articleSection: article.category,
            wordCount: this.getWordCount(article.content),
          };

          // Add keywords if available
          if (article.tags) {
            schema.keywords = article.tags.split(",").map((tag) => tag.trim());
          }

          document.getElementById("article-schema").textContent =
            JSON.stringify(schema);
        }

        optimizeImages() {
          const images = document.querySelectorAll("#post-body img");
          images.forEach((img, index) => {
            if (!img.alt) {
              img.alt = `Article image ${index + 1}`;
            }
            // Add loading="lazy" for performance
            img.loading = "lazy";
          });
        }

        getWordCount(content) {
          return content
            .replace(/<[^>]*>/g, "")
            .split(/\s+/)
            .filter((word) => word.length > 0).length;
        }

        truncateText(text, maxLength) {
          if (text.length <= maxLength) return text;
          return text.substring(0, maxLength).trim() + "...";
        }

        renderTags(tagsString) {
          const tagsContainer = document.getElementById("post-tags");

          if (!tagsString || tagsString.trim() === "") {
            tagsContainer.style.display = "none";
            return;
          }

          const tags = tagsString
            .split(",")
            .map((tag) => tag.trim())
            .filter((tag) => tag.length > 0)
            .map((tag) => {
              const capitalized = tag.charAt(0).toUpperCase() + tag.slice(1);
              return `<span class="post-tag">${capitalized}</span>`;
            })
            .join("");

          tagsContainer.innerHTML = tags;
        }

        renderNavigation(navigation) {
          const navContainer = document.getElementById("post-navigation");
          let navHTML = "";

          // Previous post
          if (navigation.previous) {
            navHTML += `
              <a href="article.html?id=${navigation.previous.id}" class="nav-post" rel="prev">
                <div class="nav-direction">‚Üê Previous Post</div>
                <div class="nav-title">${navigation.previous.title}</div>
              </a>
            `;
          } else {
            navHTML += `<div class="nav-placeholder"></div>`;
          }

          // Next post
          if (navigation.next) {
            navHTML += `
              <a href="article.html?id=${navigation.next.id}" class="nav-post" rel="next">
                <div class="nav-direction">Next Post ‚Üí</div>
                <div class="nav-title">${navigation.next.title}</div>
              </a>
            `;
          } else {
            navHTML += `<div class="nav-placeholder"></div>`;
          }

          navContainer.innerHTML = navHTML;
        }

        createExcerpt(text, characterLimit = 200) {
          const plainText = text.replace(/<[^>]*>/g, ""); // Strip HTML tags
          if (plainText.length <= characterLimit) return plainText;
          return plainText.substring(0, characterLimit).trim() + "...";
        }

        showError(message) {
          document.getElementById("loading-state").style.display = "none";
          document.getElementById("article-content").style.display = "none";
          document.getElementById("error-message").textContent = message;
          document.getElementById("error-state").style.display = "block";

          // Update page title
          document.title = "Error - JW Creative";
        }

        hideLoading() {
          document.getElementById("loading-state").style.display = "none";
          document.getElementById("error-state").style.display = "none";
          document.getElementById("article-content").style.display = "block";
        }
      }

      // Existing sidebar functions
      function toggleSidebar() {
        const sidebar = document.querySelector(".sidebar");
        sidebar.classList.toggle("active");
      }

      // Close sidebar when clicking outside on mobile
      document.addEventListener("click", function (event) {
        const sidebar = document.querySelector(".sidebar");
        const menuToggle = document.querySelector(".menu-toggle");

        if (
          window.innerWidth <= 768 &&
          !sidebar.contains(event.target) &&
          !menuToggle.contains(event.target) &&
          sidebar.classList.contains("active")
        ) {
          sidebar.classList.remove("active");
        }
      });

      // Initialize article manager when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        new ArticleManager();
      });
    </script>
  </body>
</html>
