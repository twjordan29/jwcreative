<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JW Creative - Article</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/article.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="css/all.min.css" />
    <style>
      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 3rem;
        color: #666;
      }

      .spinner {
        width: 32px;
        height: 32px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error-message {
        text-align: center;
        color: #e74c3c;
        padding: 2rem;
        background: #fdf2f2;
        border-radius: 8px;
        margin: 1rem 0;
      }

      .nav-post.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
      }

      .nav-post {
        transition: all 0.3s ease;
      }

      .nav-post:hover:not(.disabled) {
        transform: translateY(-2px);
      }

      .post-navigation {
        gap: 1rem;
      }

      .nav-placeholder {
        flex: 1;
        min-height: 80px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="profile-section">
          <div class="profile-image">JW</div>
          <h2 class="profile-name">Jordan Wheeler</h2>
          <p class="profile-title">Full Stack Developer</p>
        </div>

        <nav>
          <ul class="nav-menu">
            <li class="nav-item">
              <a href="index.html" class="nav-link">Home</a>
            </li>
            <li class="nav-item">
              <a href="index.html#about" class="nav-link">About</a>
            </li>
            <li class="nav-item">
              <a href="index.html#projects" class="nav-link">Projects</a>
            </li>
            <li class="nav-item">
              <a href="blog.html" class="nav-link active">Blog</a>
            </li>
            <li class="nav-item">
              <a href="index.html#contact" class="nav-link">Contact</a>
            </li>
          </ul>
        </nav>

        <div class="contact-info">
          <div class="contact-item">
            <div class="contact-icon">
              <i class="fa-solid fa-envelope"></i>
            </div>
            <span>hello@jwcreative.ca</span>
          </div>
          <div class="contact-item">
            <div class="contact-icon">
              <i class="fas fa-map-marker-alt"></i>
            </div>
            <span>Newfoundland, Canada</span>
          </div>

          <div class="social-links">
            <a href="#" class="social-link">
              <i class="fa-brands fa-facebook-f"></i>
            </a>
            <a href="#" class="social-link">
              <i class="fa-brands fa-instagram"></i>
            </a>
            <a href="#" class="social-link">
              <i class="fa-brands fa-x"></i>
            </a>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>

        <!-- Single Post Section -->
        <section class="post-section">
          <div class="post-container">
            <!-- Back Button -->
            <a href="blog.html" class="back-button">
              <span>‚Üê</span>
              <span>Back to Blog</span>
            </a>

            <!-- Loading State -->
            <div id="loading-state" class="loading-spinner">
              <div class="spinner"></div>
              <span>Loading article...</span>
            </div>

            <!-- Error State -->
            <div id="error-state" class="error-message" style="display: none">
              <h3>Error Loading Article</h3>
              <p id="error-message">
                Something went wrong while loading this article.
              </p>
              <a href="blog.html" style="color: #3498db; text-decoration: none"
                >‚Üê Return to Blog</a
              >
            </div>

            <!-- Article Content -->
            <div id="article-content" style="display: none">
              <!-- Post Header -->
              <header class="post-header">
                <span class="post-category" id="post-category">Loading...</span>
                <h1 class="post-title" id="post-title">Loading Article...</h1>
                <div class="post-meta">
                  <div class="meta-item">
                    <span>üìÖ</span>
                    <span id="post-date">Loading...</span>
                  </div>
                  <div class="meta-item">
                    <span>‚è±Ô∏è</span>
                    <span id="post-read-time">Loading...</span>
                  </div>
                  <div class="meta-item">
                    <span>üëÄ</span>
                    <span id="post-views">Loading...</span>
                  </div>
                  <div class="meta-item">
                    <span>‚úçÔ∏è</span>
                    <span id="post-author">Loading...</span>
                  </div>
                </div>
                <p class="post-description" id="post-description">
                  Loading description...
                </p>
              </header>

              <!-- Post Content -->
              <article class="post-content">
                <div id="post-body">Loading content...</div>

                <!-- Post Tags -->
                <div class="post-tags" id="post-tags">
                  <!-- Tags will be populated here -->
                </div>
              </article>

              <!-- Post Navigation -->
              <nav class="post-navigation" id="post-navigation">
                <!-- Navigation will be populated here -->
              </nav>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script>
      // Article management class
      class ArticleManager {
        constructor() {
          this.articleId = this.getArticleId();
          this.init();
        }

        getArticleId() {
          const params = new URLSearchParams(window.location.search);
          return params.get("id");
        }

        init() {
          if (!this.articleId) {
            this.showError("Article ID not provided.");
            return;
          }

          this.loadArticle();
        }

        async loadArticle() {
          try {
            const response = await fetch(
              `api/get-article.php?id=${this.articleId}`
            );

            if (!response.ok) {
              if (response.status === 404) {
                throw new Error("Article not found.");
              } else {
                throw new Error(
                  `Failed to load article. Status: ${response.status}`
                );
              }
            }

            const article = await response.json();

            if (article.error) {
              throw new Error(article.error);
            }

            this.renderArticle(article);
            this.hideLoading();
          } catch (error) {
            console.error("Error loading article:", error);
            this.showError(error.message);
          }
        }

        renderArticle(article) {
          // Update page title
          document.title = `${article.title} - Your Portfolio`;

          // Update article content
          document.getElementById("post-category").textContent =
            article.category || "Uncategorized";
          document.getElementById("post-title").textContent = article.title;
          document.getElementById("post-author").textContent = article.author;
          document.getElementById("post-read-time").textContent =
            article.read_time;
          document.getElementById(
            "post-views"
          ).textContent = `${article.views} views`;
          document.getElementById("post-body").innerHTML = article.content;
          // Page title
          document.title = `${article.title} | JW Creative`;

          // Format and display date
          const date = new Date(
            article.date_posted.replace(" ", "T")
          ).toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          });
          document.getElementById("post-date").textContent = date;

          // Create description from content if not provided
          const description =
            article.excerpt || this.createExcerpt(article.content, 200);
          document.getElementById("post-description").textContent = description;

          // Render tags
          this.renderTags(article.tags);

          // Render navigation
          this.renderNavigation(article.navigation);
        }

        renderTags(tagsString) {
          const tagsContainer = document.getElementById("post-tags");

          if (!tagsString || tagsString.trim() === "") {
            tagsContainer.style.display = "none";
            return;
          }

          const tags = tagsString
            .split(",")
            .map((tag) => tag.trim())
            .filter((tag) => tag.length > 0)
            .map((tag) => {
              const capitalized = tag.charAt(0).toUpperCase() + tag.slice(1);
              return `<span class="post-tag">${capitalized}</span>`;
            })
            .join("");

          tagsContainer.innerHTML = tags;
        }

        renderNavigation(navigation) {
          const navContainer = document.getElementById("post-navigation");
          let navHTML = "";

          // Previous post
          if (navigation.previous) {
            navHTML += `
              <a href="article.html?id=${navigation.previous.id}" class="nav-post">
                <div class="nav-direction">‚Üê Previous Post</div>
                <div class="nav-title">${navigation.previous.title}</div>
              </a>
            `;
          } else {
            navHTML += `<div class="nav-placeholder"></div>`;
          }

          // Next post
          if (navigation.next) {
            navHTML += `
              <a href="article.html?id=${navigation.next.id}" class="nav-post">
                <div class="nav-direction">Next Post ‚Üí</div>
                <div class="nav-title">${navigation.next.title}</div>
              </a>
            `;
          } else {
            navHTML += `<div class="nav-placeholder"></div>`;
          }

          navContainer.innerHTML = navHTML;
        }

        createExcerpt(text, characterLimit = 200) {
          const plainText = text.replace(/<[^>]*>/g, ""); // Strip HTML tags
          if (plainText.length <= characterLimit) return plainText;
          return plainText.substring(0, characterLimit).trim() + "...";
        }

        showError(message) {
          document.getElementById("loading-state").style.display = "none";
          document.getElementById("article-content").style.display = "none";
          document.getElementById("error-message").textContent = message;
          document.getElementById("error-state").style.display = "block";

          // Update page title
          document.title = "Error - Your Portfolio";
        }

        hideLoading() {
          document.getElementById("loading-state").style.display = "none";
          document.getElementById("error-state").style.display = "none";
          document.getElementById("article-content").style.display = "block";
        }
      }

      // Existing sidebar functions
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("active");
      }

      // Close sidebar when clicking outside on mobile
      document.addEventListener("click", function (event) {
        const sidebar = document.getElementById("sidebar");
        const menuToggle = document.querySelector(".menu-toggle");

        if (
          window.innerWidth <= 768 &&
          !sidebar.contains(event.target) &&
          !menuToggle.contains(event.target) &&
          sidebar.classList.contains("active")
        ) {
          sidebar.classList.remove("active");
        }
      });

      // Smooth scrolling for navigation links
      document.querySelectorAll(".nav-link").forEach((link) => {
        link.addEventListener("click", function (e) {
          if (this.getAttribute("href").startsWith("#")) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute("href"));
            if (target) {
              target.scrollIntoView({ behavior: "smooth" });
            }
          }
        });
      });

      // Initialize article manager when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        new ArticleManager();
      });
    </script>
  </body>
</html>
